@model ChatViewModel
<style>
    #messages{
        border: 1px solid black;
        border-radius: 5px;
    }
</style>
<input id="msg" type="text" placeholder="Сообщение" />
<button id="btn">Отправить</button>
<div id="messages"></div>

<script src="~/lib/microsoft/signalr/dist/browser/signalr.min.js"></script>
<script>
    var connection = new signalR.HubConnectionBuilder().withUrl("/chathub").build();
    connection.start();
    
    document.getElementById("btn").addEventListener("click", (e) => {
        e.preventDefault();
        let input = document.getElementById("msg");
        let msg = input.value;
        input.value = "";
        connection.invoke("NewMessageRequest", msg, "@Html.Raw(Model.Username)");
    });

    connection.on("NewMessage", (time, sender, message)=>{
        let elem = document.createElement("p");
        elem.innerText = `${time} ${sender}: ${message}`;
        let firstElem = document.getElementById("messages").firstChild;
        document.getElementById("messages").insertBefore(elem, firstElem);
    });

    connection.on("MemberJoined", username=>{
        let elem = document.createElement("p");
        elem.style.backgroundColor = "lightgreen";
        elem.innerText = `Пользователь ${username} подключился к чату`;
        let firstElem = document.getElementById("messages").firstChild;
        document.getElementById("messages").insertBefore(elem, firstElem);
    });

    connection.on("MemberLeft", username=>{
        let elem = document.createElement("p");
        elem.style.backgroundColor="red";
        elem.innerText = `Пользователь ${username} покинул чат`;
        let firstElem = document.getElementById("messages").firstChild;
        document.getElementById("messages").insertBefore(elem, firstElem);
    });

    window.addEventListener("unload", e=>{
        connection.invoke("MemberLeft", "@Html.Raw(Model.Username)");
    });
</script>